console.log("'Allo 'Allo!"),function($){if(!$)return void alert("jQuery is null .");$(document).delegate(".repeat-add[data-repeat]","click",function(a,b){var c=_.getSetting()||_.setSetting(this);if("init"!==b)return _.addRepeat(this),!1;var d=+c.init,e=+c.repeat.attr("data-repeat-index");if("number"==typeof d&&"number"==typeof e)for(var f=0;d-e>f;f++)_.addRepeat(this)}),$(document).delegate(".repeat-remove","click",function(){_.removeRepeat(this)});var _extend=function(a,b){for(var c in b)void 0===a[c]&&(a[c]=b[c]);return a},_={};_.getSetting=function(a){var b=$(a),c=b.data("data-repeat");return c?c:null},_.setSetting=function(e){var _defaultSetting={min:1,max:10,onMin:function(){alert("on min .")},onMax:function(){alert("on max .")},remove:function(a){_.removeRepeat(a,"xxx")}};_defaultSetting=$.extend(_defaultSetting,$.repeatSetting);var $this=$(e),_tmpl=$this.attr("data-repeat"),$tmpl=$(document.getElementById(_tmpl)),_tmplHtml="",_tmplSetting=null;if($tmpl.size()<1)return void alert("tmpl is null .");try{_tmplHtml=$.trim($tmpl.html().match(/<code>([\s\S]+)<\/code>/)[1]),function(){eval($tmpl.html().split("</code>")[1]),_tmplSetting=_extend(setting,_defaultSetting)||null}()}catch(ex){return void alert("get tmpl or setting error .")}var $repeat=$(_tmplSetting.repeat);if($repeat.size()<1)return void alert("repeat is null .");var _setting=_tmplSetting;return _setting.tmpl=_tmplHtml,_setting.repeat=$repeat,$repeat.data("data-repeat",_setting),$this.data("data-repeat",_setting),_setting},_.addRepeat=function(a){var b=$(a),c=b.data("data-repeat");if(c&&c.repeat){var d=c.repeat,e=b.closest(".repeat-item"),f=0,g=0;return e.size()>0&&(d=e.find(d.selector)),d.find(" > .repeat-item").size()>=c.max&&c.onMax?void c.onMax(a):void((!c.onAddBefore||c.onAddBefore(e,a))&&(f=d.attr("data-repeat-index")||d.find(" > .repeat-item").size(),g=d.attr("data-repeat-pindex"),e=$(c.tmpl.replace(/{#index#}/g,f++).replace(/{#pindex#}/g,g)),d.append(e).attr("data-repeat-index",f),c.onAddAfter&&c.onAddAfter(e,a),e.find(".repeat-add").trigger("click"),_.resetNo(d)))}},_.removeRepeat=function(a,b){var c=$(a),d=c.closest(".repeat-item"),e=c.closest(".repeat"),f=e.data("data-repeat");return e.find(" > .repeat-item").size()<=f.min&&f.onMin?void f.onMin(a):void((b||!f.onRemoveBefore||f.onRemoveBefore(d,a))&&(d.remove(),_.resetNo(e),f.onRemoveAfter&&f.onRemoveAfter(d,a)))},_.resetNo=function(a){a&&0!=a.size()&&(a.parents(".repeat").size()>0&&(a=a.parents(".repeat")),a.find(" > .repeat-item").each(function(a){var b=$(this);b.find(".repeat-no").filter(function(){return 1==$(this).parents(".repeat-item").size()}).html(++a),b.find(".repeat > .repeat-item").each(function(a){var b=$(this);b.find(".repeat-no").html(++a),b.find(".repeat-pno").html(b.parents(".repeat-item").find(".repeat-no").html())})}))},$(".repeat-add[data-repeat]").trigger("click","init")}(jQuery);