/*!repeat v1.2*/
;(function($){if(!$){alert("jQuery is null .");return}$(document).delegate(".repeat-add[data-repeat]","click",function(e,args){var _setting=_.getSetting()||_.setSetting(this);if(args!=="init"){_.addRepeat(this);return false}var _init=+_setting.init;var _exist=+_setting.repeat.attr("data-repeat-index");if(typeof _init!=="number"||typeof _exist!=="number"){return}for(var i=0;i<_init-_exist;i++){_.addRepeat(this)}});$(document).delegate(".repeat-remove","click",function(){_.removeRepeat(this)});var _extend=function(argu1,argu2){for(var i in argu2){if(argu1[i]===undefined){argu1[i]=argu2[i]}}return argu1};var _={};_.getSetting=function(e){var $this=$(e);var setting=$this.data("data-repeat");return(setting?setting:null)};_.setSetting=function(e){var _defaultSetting={min:1,max:10,onMin:function(){alert("on min .")},onMax:function(){alert("on max .")},remove:function(sender){_.removeRepeat(sender,"xxx")}};_defaultSetting=$.extend(_defaultSetting,$.repeatSetting);var $this=$(e);var _tmpl=$this.attr("data-repeat");var $tmpl=$(document.getElementById(_tmpl));var _tmplHtml="";var _tmplSetting=null;if($tmpl.size()<1){alert("tmpl is null .");return}try{_tmplHtml=$.trim($tmpl.html().match(/<code>([\s\S]+)<\/code>/)[1]);(function(){eval($tmpl.html().split("</code>")[1]);_tmplSetting=_extend(setting,_defaultSetting)||null})()}catch(ex){alert("get tmpl or setting error .");return}var $repeat=$(_tmplSetting.repeat);if($repeat.size()<1){alert("repeat is null .");return}var _setting=_tmplSetting;_setting.tmpl=_tmplHtml;_setting.repeat=$repeat;$repeat.data("data-repeat",_setting);$this.data("data-repeat",_setting);return _setting};_.addRepeat=function(e){var $this=$(e);var _setting=$this.data("data-repeat");if(!_setting||!_setting.repeat){return}var $repeat=_setting.repeat;var $item=$this.closest(".repeat-item");var _index=0;var _pindex=0;if($item.size()>0){$repeat=$item.find($repeat.selector)}if($repeat.find(" > .repeat-item").size()>=_setting.max&&_setting.onMax){_setting.onMax(e);return}if(_setting.onAddBefore&&!_setting.onAddBefore($item,e)){return}_index=$repeat.attr("data-repeat-index")||$repeat.find(" > .repeat-item").size();_pindex=$repeat.attr("data-repeat-pindex");$item=$(_setting.tmpl.replace(/{#index#}/g,_index++).replace(/{#pindex#}/g,_pindex));$repeat.append($item).attr("data-repeat-index",_index);_setting.onAddAfter&&_setting.onAddAfter($item,e);$item.find(".repeat-add").trigger("click");_.resetNo($repeat)};_.removeRepeat=function(e,ext){var $this=$(e);var $item=$this.closest(".repeat-item");var $repeat=$this.closest(".repeat");var _setting=$repeat.data("data-repeat");if($repeat.find(" > .repeat-item").size()<=_setting.min&&_setting.onMin){_setting.onMin(e);return}if(!ext&&_setting.onRemoveBefore&&!_setting.onRemoveBefore($item,e)){return}$item.remove();_.resetNo($repeat);_setting.onRemoveAfter&&_setting.onRemoveAfter($item,e)};_.resetNo=function($repeat){if(!$repeat||$repeat.size()==0){return}if($repeat.parents(".repeat").size()>0){$repeat=$repeat.parents(".repeat")}$repeat.find(" > .repeat-item").each(function(index){var $this=$(this);$this.find(".repeat-no").filter(function(){return $(this).parents(".repeat-item").size()==1}).html(++index);$this.find(".repeat > .repeat-item").each(function(index){var $this=$(this);$this.find(".repeat-no").html(++index);$this.find(".repeat-pno").html($this.parents(".repeat-item").find(".repeat-no").html())})})};$(".repeat-add[data-repeat]").trigger("click","init")})(jQuery);
